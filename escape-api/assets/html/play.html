{{define "styling"}}
<style>
    #lobby {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    #gameplay {
        display: none;
    }

    .hexfield {
        fill: transparent;
        stroke: yellowgreen;
        stroke-width: 1;
    }

    .hexfield:focus {
        outline: none;
    }

    .hexfield:active {
        fill: red;
        outline: none;
    }

    .hexfield.wall {
        fill: brown;
    }

    .hexfield.safe {
        fill: white;
    }

    .hexfield.dangerous {
        fill: gray;
    }

    .hexfield.pod {
        fill: black;
    }

    .hexfield.pod-used {
        fill: purple;
    }

    .hexfield.alienstart {
        fill: red;
    }

    .hexfield.humanstart {
        fill: blue;
    }

    .hexfield:hover {
        fill: green;
    }

    .hexfield.player {
        fill: orange;
    }

    .notification-popup {
        position: fixed;
        top: 0;
        left: 44%;
        width: 10%;
        background-color: black;
        z-index: 5000;
        color: white;
        padding: 20px;
        border-radius: 10px;
        border: 2px solid rgb(0, 0, 155);
        text-align: center;
        transform: translateY(-50%);
        transition: all 0.5s ease-in-out;
        opacity: 0;
    }

    .notification-displayed {
        transform: translateY(25%);
        transition: all 0.5s ease-in-out;
        opacity: 1;
    }
</style>
{{end}}

{{define "body"}}
<div id="notification-popup" class="notification-popup">
    <div id="notification-header">
        <span style="font-weight: bold; font-size: large" id="notification-title">Alert</span>
        <span style="font-size: 20px; cursor: pointer; float: right;" onclick="hideNotification()">&times;</span>
    </div>
    <div id="notification-content"></div>
</div>
<div id="lobby">
    <h3>Lobby</h3>
    <div id="lobby-roomCode"></div>
    <div id="lobby-playerList"></div>
    <div id="lobby-gameConfig">
        <input type="number" id="config-numHumans" placeholder="Human Players" />
        <input type="number" id="config-numAliens" placeholder="Alien Players" />
        <input type="number" id="config-numWorkingPods" placeholder="Working Pods" />
        <input type="number" id="config-numBrokenPods" placeholder="Broken Pods" />
    </div>
    <button id="lobby-startButton" style="display: none;">Start</button>
</div>
<div id="gameplay">
    <div id="gameplay-gridParent"></div>
    <button type="button" onclick="attack()">Attack</button>
</div>
{{end}}

{{define "scripts"}}
<script src="/assets/js/websocket.js"></script>
<script src="/assets/js/mapplayer.js"></script>
<script>
    var ws = null;
    var thisPlayer = null;
    var thisGameStateId = null;
    var isThisPlayersTurn = false;

    function attack() {
        var actionToSend = {
            gameId: thisGameStateId,
            action: {
                type: "Attack",
                turn: {
                    row: thisPlayer.row,
                    col: thisPlayer.col
                }
            }
        }

        sendWsMessage(ws, 'submitAction', actionToSend)
    }

    function openSocket() {
        urlParams = new URLSearchParams(window.location.search)

        var playerName = urlParams.get("playerName")
        if (!playerName?.length > 0) {
            console.error("no player name found")
            return
        }
        if (urlParams.has("mapId") && !urlParams.has("roomCode")) {
            var mapId = urlParams.get("mapId")

            var urlToConnect = `ws://${window.location.host}/lobby/host?mapId=${mapId}&playerName=${playerName}`
        } else if (urlParams.has("roomCode") && !urlParams.has("mapId")) {
            var roomCode = urlParams.get("roomCode")

            var urlToConnect = `ws://${window.location.host}/lobby/join?roomCode=${roomCode}&playerName=${playerName}`
        } else {
            console.error("Something went wrong trying to detect mode")
            return;
        }

        ws = new WebSocket(urlToConnect)

        ws.addEventListener('message', (wsMsg) => {
            var message = JSON.parse(wsMsg.data)
            handleWsMessage(message)
        })
    }

    openSocket();
    // var lobby = {"type":"LobbyInfo","data":{"playerID":"1736982926867JZTAZ5F8TB","lobbyInfo":{"roomCode":"TTWQ","mapId":"1736982914988TDU0HZGRU9","gameStateId":"","status":"Awaiting Start","numPlayers":1,"maxPlayers":12,"players":[{"id":"1736982926867JZTAZ5F8TB","name":"Ryan","team":"","role":"","row":0,"col":0}],"host":{"id":"1736982926867JZTAZ5F8TB","name":"Ryan","team":"","role":"","row":0,"col":0}}}}	
    // handleLobbyInfoMessage(lobby.data)

    function showNotification(notificationContent, notificationType) {
        var popup = document.getElementById("notification-popup");
        var content = document.getElementById("notification-content");
        var title = document.getElementById("notification-title");

        content.innerText = notificationContent;
        title.innerText = notificationType;
        popup.classList.add('notification-displayed')
    }

    function hideNotification() {
        var popup = document.getElementById("notification-popup");
        popup.classList.remove('notification-displayed')
    }
</script>
{{end}}